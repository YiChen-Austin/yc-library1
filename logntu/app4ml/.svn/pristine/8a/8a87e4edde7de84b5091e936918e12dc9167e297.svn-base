<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="include/head.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title><%=projectTitle%></title>
<link rel="icon" href="<%=path%>/images/logo/ml_ico.ico"
	type="image/x-icon" />
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<link href="<%=path%>/css/style.css" rel="stylesheet" />
<link href="<%=path%>/css/bootstrap.css" rel="stylesheet" />
</head>
<body>
	<jsp:include page="include/top.jsp" />
	<div class="main w1100">
		<jsp:include page="include/left.jsp">
			<jsp:param name="tag" value="main" />
		</jsp:include>
		<div class="main-center fl">
			<div class="main-header">首页</div>
			<ul class="main-title">
				<div>
					<span>账号：${session_mem_user.userName}</span> <a href="javascript:void(0)"
						onclick="xgPassword()">修改密码</a>
				</div>
				<li><span>龙途币余额：0</span> <a href="<%=project%>/pay4l">充值</a><a>|</a><a href="<%=project%>/member/recharge">充值查询</a>
				</li>
				<li><span>当前可用积分：0</span></li>
			</ul>
		</div>
		<div class="main-right fl">
			<ul class="qd-header">
				<li class="fl jr"><span>今日积分</span>
					<p>0</p></li>
				<li class="fl lj"><span>累计积分</span>
					<p>0</p></li>
			</ul>
			<div class="qd-button qd-div">
				<a href=""><i></i>签到领积分</a>
			</div>
			<div class="qd-div">
				<ul class="qdxq">
					<li><i></i> <span>签到领积分</span></li>
					<a class="fr" href="">查看积分明细 +</a>
				</ul>
			</div>
		</div>
	</div>
	<jsp:include page="include/bottom.jsp" />
</body>
<script src="<%=path%>/js/jquery-1.9.1.min.js"></script>
<script src="<%=path%>/js/validate.js"></script>
<script src="<%=path%>/js/layer.js"></script>
<script>
	function xgPassword() {
		layer
				.open({
					type : 1,
					skin : 'a-gg', //样式类名
					closeBtn : 1, //不显示关闭按钮
					shift : 2,
					title : '修改密码',
					shadeClose : true, //开启遮罩关闭
					content : '<ul class="form-horizontal register-con sj active"> <li class="form-group"> <input type="password"  placeholder="输入旧密码" class="form-control" id="oldpassword"> </li> <li class="form-group"> <input type="password"  placeholder="输入新密码" class="form-control" id="newpassword"></li><li> <input type="password"  placeholder="确认新密码" class="form-control" id="qrpassword"> </li>  <li class="form-group"> <button class="btn tj fr dl" onclick="toPassword()">确认</button> </li> </ul>'
				});
		$("#oldpassword").blur(function() {
			var val = new validate({
				rules : {
					oldpassword : "password",
				},
				submitFun : function() {
					var user = {
						OldPassword : $("#oldpassword").val(),
					};
				}
			})
		})
		$("#newpassword").blur(function() {
			var val = new validate({
				rules : {
					newpassword : "password"
				},
				submitFun : function() {
					var user = {
						NewPassword : $("#newpassword").val(),
					};
				}
			})
		})
		$("#qrpassword")
				.blur(
						function() {
							var password = $('#newpassword').val();
							var password1 = $('#qrpassword').val();
							if (password != password1) {
								$("#qrpassword")
										.after(
												'<label class="s" style="color:#b91c21;width:70%;">密码不一致</label>');
								$(".s:gt(0)").remove();
								return false;
							} else {
								$(".s").remove();
							}
						})
	}

	function toPassword() {
		var newpassword = $('#newpassword').val();
		var qrpassword = $('#qrpassword').val();
		if (newpassword != qrpassword) {
			$("#qrpassword").after(
					'<label class="s" style="color:#b91c21;width:70%;">密码不一致</label>');
			$(".s:gt(0)").remove();
			return false;
		} else {
			$(".s").remove();
		}
		var val = new validate({
			rules : {
				oldpassword : "password",
				newpassword : "password"
			},
			submitFun : function() {
				toPassword1();
			}
		})
	}

	function toPassword1() {
		var dengdai1 = layer.load(0, {
			shade : [ 0.1, '#fff' ]
		//0.1透明度的白色背景
		});
		var user = {
				oldPw : $("#oldpassword").val(),
			newPw : $("#newpassword").val(),
		};
		$
				.ajax({
					url : 'updatePw',
					data : user,
					type : 'post',
					dataType : 'json',
					success : function(msg) {
						if (msg.serviceCode==0) {
							layer.close(dengdai1);
							layer.closeAll();
							layer.msg('修改成功');
						} else {
							layer.close(dengdai1);
							layer.closeAll();
							layer.msg('修改失败');
						}
					}
				})
	}
</script>
</html>

