var src = $('#src').text();
(function() {
    load_server_data('');
})();
//加载服务器数据
function load_server_data(){
    var serverId='',prClass='';
    if($(this).attr("server_id")){
        serverId=$(this).attr("server_id");
        prClass=$(this).attr("pre_class");
    }
    //删除所有子元素
    if(serverId){
        $("#select_zone .s_"+serverId).each(function(i, item) {
            $(item).remove();
        });
        $(this).prevAll().each(function(i, item) {
            $("#select_zone .s_"+$(item).attr("server_id")).each(function(i, xitem) {
                $(xitem).remove();
            });
        });
        $(this).nextAll().each(function(i, item) {
            $("#select_zone .s_"+$(item).attr("server_id")).each(function(i, xitem) {
                $(xitem).remove();
            });
        });
    }
    _data={"serverId":serverId};
    $.ajax({
        url: src+'/pay/serverZone',
        data:_data,
        type:'post',
        dataType:'json',
        success:function(json){
            if(json){
                if(!serverId){
                    serverId="00";
                }
                var isNext=false;
                var _html='';
                _html+='<div class="nice-select fl s_'+serverId+' '+prClass+'" id="u_'+serverId+'" name="nice-select">';
                _html+='<input type="text" value="请选择" readonly>';
                _html+='<ul>';
                $.each(json,function(i, item) {
                    _html+='<li server_id="'+item.serverId+'" pre_class="'+prClass+' s_'+serverId+'" value="'+item.serverId+'" data-value='+i+'>'+item.serverName+'</li>';
                    if(parseInt(item.subLayer)>0){
                        isNext=true;
                    }
                });
                _html+='</ul></div>';
                $("#select_zone").append(_html); 
                selectVal();
                if(isNext){
                    $("#u_"+serverId+" li").bind("click",load_server_data);
                }else{
                	$("#u_"+serverId+" li").bind("click",load_role_data);
                }
            }
        }
    })
}
//加载角色名字
function load_role_data(){
	 var serverId='',prClass='';
		if($(this).attr("server_id")){
		    serverId=$(this).attr("server_id");
		    prClass=$(this).attr("pre_class");
		}
		//删除所有子元素
	    if(serverId){
	        $("#select_zone .s_"+serverId).each(function(i, item) {
	            $(item).remove();
	        });
	        $(this).prevAll().each(function(i, item) {
	            $("#select_zone .s_"+$(item).attr("server_id")).each(function(i, xitem) {
	                $(xitem).remove();
	            });
	        });
	        $(this).nextAll().each(function(i, item) {
	            $("#select_zone .s_"+$(item).attr("server_id")).each(function(i, xitem) {
	                $(xitem).remove();
	            });
	        });
	    }
		_data={"serverId":serverId};
    $.ajax({
        url: src+'/pay/serverRole',
        data:_data,
        type:'post',
        dataType:'json',
        success:function(json){
            if(json){
                if(!serverId){
                    serverId="00";
                }
                var isNext=false;
                var _html='';
                _html+='<div class="nice-select fl s_'+serverId+' '+prClass+'" id="u_'+serverId+'" name="nice-select">';
                _html+='<input type="text" value="请选择" readonly>';
                _html+='<ul>';
                $.each(json,function(i, item) {
                    _html+='<li server_id="'+item.serverId+'" pre_class="'+prClass+' s_'+serverId+'" value="'+item.serverId+'" data-value='+i+'>'+item.serverName+'</li>';
                    if(parseInt(item.subLayer)>0){
                        isNext=true;
                    }
                });
                _html+='</ul></div>';
                $("#select_zone").append(_html); 
                selectVal();
                if(isNext){
                	$("#u_"+serverId+" li").bind("click",load_role_data);
                }
            }
        }
    })
}
//下拉框
function selectVal(){
    $('[name="nice-select"]').click(function(e){
        $('[name="nice-select"]').find('ul').hide();
        $(this).find('ul').show();
        e.stopPropagation();
    });
    $('[name="nice-select"]').eq(2).addClass('ss');
    
    $('[name="nice-select"] li').hover(function(e){
        $(this).toggleClass('on');
        e.stopPropagation();
    });
    $('[name="nice-select"] li').click(function(e){
        var val = $(this).text();
        $(this).parents('[name="nice-select"]').find('input').val(val);
        $('[name="nice-select"] ul').hide();
        e.stopPropagation();
    });
    $(document).click(function(){
        $('[name="nice-select"] ul').hide();
    });
}
var stb2 = $('.czje');
stb2.click(function() {
    $(this).addClass('active').siblings().removeClass('active');
});

$('.zffs-li:gt(0)').hide();//隐藏大于0
var stb3 = $('.zffs label');
stb3.click(function() {
    $(this).addClass('active').siblings().removeClass('active');
    var stb_index3 = stb3.index(this);//index(this)获取对象参数 获取ct的第几个
    $('.zffs-li').eq(stb_index3).show()//如果ct的和li相等就显示
        .siblings().hide();//隐藏掉上一个执行
});

var stb4 = $('.lex label');
stb4.click(function() {
    $(this).addClass('active').siblings().removeClass('active');
});
var stb5 = $('.xzyh label');
stb5.click(function() {
    $(this).addClass('active').siblings().removeClass('active');
});
var stb6 = $('.jl label');
stb6.click(function() {
    $(this).addClass('active').siblings().removeClass('active');
});

$('.bd:gt(0)').hide();//隐藏大于0
var stb6 = $('.jl label');
stb6.click(function() {
    $(this).addClass('active').siblings().removeClass('active');
    var stb_index3 = stb6.index(this);//index(this)获取对象参数 获取ct的第几个
    $('.bd').eq(stb_index3).show()//如果ct的和li相等就显示
        .siblings().hide();//隐藏掉上一个执行
});

$('.z').click(function() {
    $('.form-amount').html($(this).html() / 10)
});
$('.je').blur(function() {
    var jg = $(".je").val();
    if (jg != null) {
        $('.form-amount').html($('.je').val() / 10);
    }
})
//支付宝支付
function alipay() {
	var alipay_data = {
	        "userName":$("#payid").val(),
	        "yf":$("#yf").text(),
	    };
    $.ajax({
        url:'sss',
        data : alipay_data,
        type : 'post',
        dataType : 'json',
        success : function(msg) {
            if (msg.serviceCode == '0') {
            	window.open("http://www.baidu.com");
                layer.open({
                    type: 1,
                    skin: 'a-gg', //样式类名
                    closeBtn: 1, //不显示关闭按钮
                    shift: 2,
                    title: '登陆支付宝支付',
                    shadeClose: true, //开启遮罩关闭
                    content: '<div>请您在新打开的支付宝页面完成支付，支付完成前请不要关闭该窗口</div><div><a href="">已完成支付</a><a href="">支付时遇见问题</a></div>'
                });
            } else {
               
            }
        }
    })
}
//判断按钮是否能点
var val = $("#payid").val();
if(val==''){
	$('.ljzf').attr('disabled',"true");
    $('.ljzf').addClass('bgh');
}else{
	$('.ljzf').removeAttr("disabled");
    $('.ljzf').removeClass('bgh');
}
//判断账号是否存在
function payID(){
    $('#payidlab').css('display','none');
    $('.ljzf').removeAttr("disabled");
    $('.ljzf').removeClass('bgh');
    var _data = {
        "userName":$("#payid").val(),
    };
    
    $.ajax({
        url:src+'/pay/validUn',
        data : _data,
        type : 'post',
        dataType : 'json',
        success : function(msg) {
            if (msg.serviceCode == '0') {
                $('#payidlab').css('display','none');
            } else {
                $('#payidlab').css('display', 'inline-block');
                $('#payidlab span').text('没有此账号，请注册！！！');
                $('.ljzf').attr('disabled',"true");
                $('.ljzf').addClass('bgh');
            }
        }
    })
}
//判断只能输入数字
$('.num').keyup(function() {
    var tmptxt = $(this).val();
    $(this).val(tmptxt.replace(/\D|^0/g, ''));
}).bind("paste", function() {
    var tmptxt = $(this).val();
    $(this).val(tmptxt.replace(/\D|^0/g, ''));
}).css("ime-mode", "disabled");
$('.je').change(function() {
    var number = $(this).val();
    if(number < 100){
        $('.je').val("100");
    }
})
